<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700,800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../html/servicios.css">
  <script src="https://code.jquery.com/jquery-3.6.1.min.js"
    integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
  <script defer src="../html/service.js"></script>
  <style>
    /* Estilo personalizado */
    .border-line {
      border-bottom: 1px solid black;
      margin-bottom: 20px;
      width: 100%;
    }

    .table-gray {
      background-color: #f8f9fa;
      /* Color gris */
    }

    .animated {
      -webkit-animation-duration: 1s;
      animation-duration: 1s;
      -webkit-animation-fill-mode: both;
      animation-fill-mode: both;
    }

    .animated.faster {
      -webkit-animation-duration: 500ms;
      animation-duration: 500ms;
    }

    .fadeIn {
      -webkit-animation-name: fadeIn;
      animation-name: fadeIn;
    }

    .fadeOut {
      -webkit-animation-name: fadeOut;
      animation-name: fadeOut;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    @keyframes fadeOut {
      from {
        opacity: 1;
      }

      to {
        opacity: 0;
      }
    }
  </style>
</head>

<body class="body-admin">
  <!-- Incluir la barra de navegación -->
  <header class="header">
    <h1 class="title-admin h1"> World Software </h1>
    <nav class="nav">
      <ul class="ul">
        <li class="li"><a class="a-admin" href="../index.html" title="Inicio" class="a">Inicio</a></li>
        <li class="li"><a class="a-admin" href="#nosotros" title="Trabajos" class="a">Nosotros</a></li>
        <li class="li"><a class="a-admin" href="../html/services.html" title="sobre mi" class="a">Nuestros Servicios</a>
        </li>
        <li class="li"><a class="a-admin" href="../cont/contactenos.html" title="sobre mi" class="a">Contactanos</a>
        </li>
        <li class="li"><a class="a-admin" href="../admin/admin.html" title="admin" class="a">Admin</a></li>
      </ul>
    </nav>
  </header>

  <div class="">

    <div class="flex justify-between items-center bg-blue-900 text-white p-4 mb-3">
      <h2 class="text-left font-bold text-2xl">Administración</h2>
      <div class="text-end mb-3 container">
        <button class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded mr-2">Borrar</button>
        <button onclick="openModal()"
          class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded text-black">Nuevo
          registro</button>
      </div>
    </div>


    <div class="border-line"></div>



    <!-- INICIO MODAL -->
    <div
      class="main-modal fixed w-full h-100 inset-0 z-50 overflow-hidden flex justify-center items-center animated fadeIn faster"
      style="background: rgba(0,0,0,.7);">
      <div
        class="border border-teal-500 shadow-lg modal-container bg-white w-11/12 md:max-w-md mx-auto rounded shadow-lg z-50 overflow-y-auto">
        <div class="modal-content py-4 text-left px-6">
          <!--Title-->
          <div class="flex justify-between items-center pb-3">

            <p class="text-2xl text-blue-900 font-bold mx-auto">Nuevo Registro</p>

            <div class="modal-close cursor-pointer z-50">
              <svg class="fill-current text-black" xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                viewBox="0 0 18 18">
                <path
                  d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z">
                </path>
              </svg>
            </div>
          </div>

          <!--Body-->
          <div class="flex justify-center items-center">
            <form class="formularioRegistro bg-white px-8 pt-6 pb-8">
              <!-- Primera fila -->
              <div class="flex mb-4">
                <!-- Primer campo -->
                <div class="w-1/2 mr-2">
                  <input name="name"
                    class="name shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                    id="name" type="text" placeholder="Nombre">
                </div>
                <!-- Segundo campo -->
                <div class="w-1/2 ml-2">
                  <input name="email"
                    class="email shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                    id="email" type="text" placeholder="Correo">
                </div>
              </div>
              <!-- Segunda fila -->
              <div class="flex mb-4">
                <!-- Tercer campo -->
                <div class="w-1/2 mr-2">
                  <input name="phone"
                    class="phone shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                    id="phone" type="text" placeholder="Teléfono">
                </div>
                <!-- Cuarto campo -->
                <div class="w-1/2 ml-2">
                  <input name="address"
                    class=" addressshadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                    id="address" type="text" placeholder="Dirección">
                </div>
              </div>

          </div>

          <!--Footer-->
          <div class="flex justify-center">
            <button type="submit"
              class="focus:outline-none px-4 bg-teal-500 p-2 mr-3 rounded-lg text-white hover:bg-teal-400">Guardar</button>
            </form>
            <button
              class="focus:outline-none modal-close px-4 bg-gray-400 p-2 rounded-lg text-black hover:bg-gray-300">Cancel</button>
          </div>
        </div>
      </div>
    </div>
    <!-- FINAL MODAL -->

    <!-- Tabla centrada horizontalmente -->
    <div class="table-responsive container" id="table">
      <table class="table table-light table-striped table-bordered text-center table-gray">
        <thead>
          <tr>
            <th>
              <div class="flex justify-center items-center"> <input type="checkbox" id="miCheckbox" name="miCheckbox"
                  class="mr-2"></div>
            </th>
            <th>Nombre</th>
            <th>gmail</th>
            <th>Dirección</th>
            <th>Celular</th>
            <th>Gestionar</th>
          </tr>
        </thead>
        <tbody id="tbody">

          <!-- Agrega más filas según sea necesario -->
        </tbody>
      </table>
    </div>

    <!-- INICIO MODAL EDITAR-->
    <div
      class="modal-edit opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center">
      <div class="modal-overlay-edit absolute w-full h-full bg-gray-900 opacity-50"></div>

      <div class="modal-container-edit bg-white w-11/12 md:max-w-md mx-auto rounded shadow-lg z-50 overflow-y-auto">

        <div
          class="modal-close-edit absolute top-0 right-0 cursor-pointer flex flex-col items-center mt-4 mr-4 text-white text-sm z-50">
          <svg class="fill-current text-white" xmlns="http://www.w3.org/2000/svg" width="18" height="18"
            viewBox="0 0 18 18">
            <path
              d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z">
            </path>
          </svg>
          <span class="text-sm">(Esc)</span>
        </div>

        <!-- Add margin if you want to see some of the overlay behind the modal-->
        <div class="modal-content-edit py-4 text-left px-6">
          <!--Title-->
          <div class="flex justify-between items-center pb-3">
            <p class="text-2xl font-bold mx-auto text-blue-900">Actualizar Registro</p>
            <div class="modal-close-edit cursor-pointer z-50">
              <svg class="fill-current text-black" xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                viewBox="0 0 18 18">
                <path
                  d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z">
                </path>
              </svg>
            </div>
          </div>

          <!--Body-->
          <div class="flex justify-center items-center">
            <form class="formularioEditar bg-white px-8 pt-6 pb-8">
              <!-- Primera fila -->
              <div class="flex mb-4">
                <input name="id"
                  class="id shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                  id="id" type="hidden">
                <!-- Primer campo -->
                <div class="w-1/2 mr-2">
                  <input name="name"
                    class="name shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                    id="name" type="text" placeholder="Nombre">
                </div>
                <!-- Segundo campo -->
                <div class="w-1/2 ml-2">
                  <input name="email"
                    class="email shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                    id="email" type="text" placeholder="Correo">
                </div>
              </div>
              <!-- Segunda fila -->
              <div class="flex mb-4">
                <!-- Tercer campo -->
                <div class="w-1/2 mr-2">
                  <input name="phone"
                    class="phone shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                    id="phone" type="text" placeholder="Teléfono">
                </div>
                <!-- Cuarto campo -->
                <div class="w-1/2 ml-2">
                  <input name="address"
                    class="address shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                    id="address" type="text" placeholder="dirreción">
                </div>
              </div>

          </div>

          <!--Footer-->
          <div class="flex justify-center">
            <button type="submit"
              class="focus:outline-none px-4 bg-teal-500 p-2 mr-3 rounded-lg text-white hover:bg-teal-400">Actualizar</button>
            </form>
            <button
              class="focus:outline-none modal-close-edit px-4 bg-gray-400 p-2 rounded-lg text-black hover:bg-gray-300">Cancel</button>

          </div>

        </div>
      </div>
    </div>
    <!-- FINAL MODAL EDITAR-->

    <!-- INICIO MODAL DELETE -->
    <div
      class="main-modal-delete hidden fixed w-full h-100 inset-0 z-50 overflow-hidden flex justify-center items-center animated fadeIn faster"
      style="background: rgba(0,0,0,.7);">
      <div
        class="border border-teal-500 shadow-lg modal-container-delete bg-white w-11/12 md:max-w-md mx-auto rounded shadow-lg z-50 overflow-y-auto">
        <div class="modal-content-delete py-4 text-left px-6">
          <!--Title-->
          <form class="formularioDelete bg-white px-8 pt-6 pb-8">

            <input name="id"
              class="id shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
              id="id" type="hidden">

            <div class="flex justify-between items-center pb-3">
              <p class="text-2xl font-bold mx-auto text-center text-blue-900">¿Estás seguro de eliminar el registro?</p>
              <div class="modal-close-delete cursor-pointer z-50">

              </div>
            </div>
            <!--Footer-->
            <div class="flex justify-center">
              <button type="submit"
                class="focus:outline-none px-4 bg-teal-500 p-2 mr-3 rounded-lg text-white hover:bg-teal-400">SI</button>
                  </form>

        
          <button
            class="focus:outline-none modal-close-delete px-4 bg-gray-400 p-2 rounded-lg text-black hover:bg-gray-300">NO</button>
          </div>
        </div>
      </div>
    </div>

  </div>
  <!-- FINAL MODAL DELETE -->

  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="./admin.js"></script>
  <!-- Incluir el pie de página -->
  <footer class="footer">
    <section class="seccion-footer">
      <h3 class="h3">SIGUENOS</h3>
      <div class="redes-sociales">
        <a href="#" class="social-icon"><i class="fab fa-facebook"></i></a>
        <a href="#" class="social-icon"><i class="fab fa-twitter"></i></a>
        <a href="#" class="social-icon"><i class="fab fa-instagram"></i></a>
      </div>
    </section>

    <section class="seccion-footer">
      <h3 class="h3">CONTACTANOS</h3>
      <p>Teléfono: 123-456-789</p>
      <p>Correo: ejemplo@correo.com</p>
    </section>

    <section class="seccion-footer">
      <h3 class="h3">BOLETIN</h3>
      <div class="chat-box">
        <i class="fas fa-comment-alt"></i>
        <p>Chat en vivo</p>
      </div>
    </section>
  </footer>

  <script>
    const d = document,
      $form = d.querySelector(".formularioRegistro");
    $formEdit = d.querySelector(".formularioEditar");
    $formDelete = d.querySelector(".formularioDelete");

    function td_fun({ id, name, email, phone, address }) {
      let td = document.createElement('tr');
      td.innerHTML = `
                        <td><div class="flex justify-center items-center">   <input type="checkbox" id="miCheckbox" name="miCheckbox" class="mr-2"></div></td>
                        <td>${name}</td>
                        <td>${email}</td>
                        <td>${address}</td>
                        <td>${phone}</td>
                        <td>
                        <button class="btn-editar" 
                        data-id="${id}" data-name="${name}" data-email="${email}" data-phone="${phone}" data-address="${address}"
                        >
                        <i class="bi bi-pencil text-yellow-500"></i>
                        </button>
                        <button class="btn-delete" data-id="${id}">
                          <i class="bi bi-trash text-red-500"></i>
                        </button>

                      </td>
                        
    `;

      const btnEditar = td.querySelector('.btn-editar');
      btnEditar.addEventListener('click', () => {
        // Aquí puedes abrir el modal o realizar cualquier otra acción que necesites
        toggleModal(); // Suponiendo que openModal es la función que abre tu modal
      });

      const btnDelete = td.querySelector('.btn-delete');
      btnDelete.addEventListener('click', () => {
        openModalDelete(); // Suponiendo que openModalDelete es la función que abre tu modal de eliminación
      });
      return td;
    }

    d.addEventListener("submit", async e => {
      if (e.target === $form) {
        e.preventDefault();
        //Create - POST
        try {
          console.log("test nuevo registro");
          let options = {
            method: "POST",
            headers: {
              "Content-type": "application/json; charset=utf-8"
            },
            body: JSON.stringify({
              name: e.target.name.value,
              email: e.target.email.value,
              address: e.target.address.value,
              phone: e.target.phone.value
            })
          },
            res = await fetch("http://localhost:3000/users", options),
            json = await res.json();

          if (!res.ok) throw { status: res.status, statusText: res.statusText };

          location.reload();
        } catch (err) {
          let message = err.statusText || "Ocurrió un error";
          $form.insertAdjacentHTML("afterend", `<p><b>Error ${err.status}: ${message}</b></p>`);
        }
      }


      if (e.target === $formEdit) {
        e.preventDefault();


        try {

          console.log("actualizar formulario");
          let id = e.target.id.value; // Obtener el valor del campo id
          console.log(id);
          console.log(e.target.name.value);
          console.log(e.target.email.value);
          console.log(e.target.phone.value);
          console.log(e.target.address.value);

          let options = {
            method: "PUT",
            headers: {
              "Content-type": "application/json; charset=utf-8"
            },
            body: JSON.stringify({
              name: e.target.name.value,
              email: e.target.email.value,
              phone: e.target.phone.value,
              address: e.target.address.value
            })
          },
            res = await fetch(`http://localhost:3000/users/${id}`, options),
            json = await res.json();

          if (!res.ok) throw { status: res.status, statusText: res.statusText };

          location.reload();
        } catch (err) {
          let message = err.statusText || "Ocurrió un error";
          $form.insertAdjacentHTML("afterend", `<p><b>Error ${err.status}: ${message}</b></p>`);
        }
      }

      if (e.target === $formDelete) {

        try {
          console.log("BORRAR");
          let id = e.target.id.value; // Obtener el valor del campo id
          console.log(id);

          let options = {
            method: "DELETE",
            headers: {
              "Content-type": "application/json; charset=utf-8"
            }
          },
            res = await fetch(`http://localhost:3000/users/${id}`, options),
            json = await res.json();

          if (!res.ok) throw { status: res.status, statusText: res.statusText };

          location.reload();
        } catch (err) {
          let message = err.statusText || "Ocurrió un error";

        }
      }

    });


    d.addEventListener("click", async e => {
      console.log("hola");
      if (e.target.matches(".btn-editar")) {

        const id = e.target.dataset.id;
        const name = e.target.dataset.name;
        const email = e.target.dataset.email;
        const phone = e.target.dataset.phone;
        const address = e.target.dataset.address;

        console.log("EDITAR =========== " + id);

        $formEdit.id.value = id;
        $formEdit.name.value = name;
        $formEdit.email.value = email;
        $formEdit.phone.value = phone;
        $formEdit.address.value = address;

      }

      if (e.target.matches(".btn-delete")) {
        
        const id = e.target.dataset.id;
        $formDelete.id.value = id;
        console.log("BOTON ELIMINAR ID " + id);


      }



    });

  </script>
</body>

</html>